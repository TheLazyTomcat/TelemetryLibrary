<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>
<title>SCS Telemetry library: TelemetryNetIncomingStream: Class TIncomingStream</title>
<meta name="generator" content="PasDoc 0.13.0">
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
<link rel="StyleSheet" type="text/css" href="pasdoc.css">
</head>
<body class="content">
<a name="TIncomingStream"></a><h1 class="cio">Class TIncomingStream</h1>
<table class="sections wide_list">
<tr>
<td><a class="section" href="#PasDoc-Description">Description</a></td><td><a class="section" href="#PasDoc-Hierarchy">Hierarchy</a></td><td><a class="section" href="#PasDoc-Fields">Fields</a></td><td><a class="section" href="#PasDoc-Methods">Methods</a></td><td><a class="section" href="#PasDoc-Properties">Properties</a></td></tr></table>
<a name="PasDoc-Description"></a><h2 class="unit">Unit</h2>
<p class="unitlink">
<a  href="TelemetryNetIncomingStream.html">TelemetryNetIncomingStream</a></p>
<h2 class="declaration">Declaration</h2>
<p class="declaration">
<code>type TIncomingStream = class(TMemoryStream)</code></p>
<h2 class="description">Description</h2>
<p>
<code>TIncomingStream</code> serves as per-connection buffer for incoming data.</p>
<p>
 Server-client communication is realized trought variable size packets, but incoming data do not have guaranteed size. That means, any incoming data have to be checked if they are complete, and when not, they must be stored and next received part must be appended at the end of them and the whole stream must be checked again.

<p>For better undestanding, here is small example: </p>

<ul class="paragraph_spacing">
  <li><p>sender sends packet 120 bytes long</p></li>
  <li><p>receiver receives 100 bytes</p></li>
  <li><p>they are checket for length, but are marked as incomplete (each packet has minimal size and actual size minus header size is stored at the beginning of each packet - see unit <a class="normal" href="TelemetryNetPackets.html">TelemetryNetPackets</a> for details)</p></li>
  <li><p>incomplete data are stored to stream</p></li>
  <li><p>receiver receives 24 bytes</p></li>
  <li><p>they are appended and the whole stream is checked</p></li>
  <li><p>as the stream is now evaluated as one complete packet 120 bytes long plus 4 additional unknown bytes, the first 120 bytes are passed as valid packet for further processing</p></li>
  <li><p>after processing is done, the packet is removed, which means the stream now contains 4 bytes (probably first part of next packet)</p></li>
</ul>

<p>

<p>As this class is direct descendant of TMemoryStream, it contains all of its methods and fields and the actual memory stream is used internally.

<p>

<p>

<p>

<p>

<p>

<p>

<p>

<p>

<p>

<p>

<p>

<p></p>
<a name="PasDoc-Hierarchy"></a><h2 class="hierarchy">Hierarchy</h2>
<ul class="hierarchy"><li class="ancestor">TMemoryStream</li>
<li class="thisitem">TIncomingStream</li></ul><h2 class="overview">Overview</h2>
<a name="PasDoc-Fields"></a><h3 class="summary">Fields</h3>
<table class="summary wide_list">
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="private.gif" alt="Private" title="Private"></a></td>
<td class="itemcode"><code><b><a  href="TelemetryNetIncomingStream.TIncomingStream.html#fSocket">fSocket</a></b>:          TCustomWinSocket;</code></td>
</tr>
<tr class="list2">
<td class="visibility"><a  href="legend.html"><img  src="private.gif" alt="Private" title="Private"></a></td>
<td class="itemcode"><code><b><a  href="TelemetryNetIncomingStream.TIncomingStream.html#fMaxSize">fMaxSize</a></b>:         LongWord;</code></td>
</tr>
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="private.gif" alt="Private" title="Private"></a></td>
<td class="itemcode"><code><b><a  href="TelemetryNetIncomingStream.TIncomingStream.html#fOnOverflowClear">fOnOverflowClear</a></b>: TSocketNotifyEvent;</code></td>
</tr>
<tr class="list2">
<td class="visibility"><a  href="legend.html"><img  src="private.gif" alt="Private" title="Private"></a></td>
<td class="itemcode"><code><b><a  href="TelemetryNetIncomingStream.TIncomingStream.html#fOnPacket">fOnPacket</a></b>:        <a  href="TelemetryNetPackets.html#TPacketNotifyEvent">TPacketNotifyEvent</a>;</code></td>
</tr>
</table>
<a name="PasDoc-Methods"></a><h3 class="summary">Methods</h3>
<table class="summary wide_list">
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="protected.gif" alt="Protected" title="Protected"></a></td>
<td class="itemcode"><code>Function <b><a  href="TelemetryNetIncomingStream.TIncomingStream.html#DirectBufferProcessing">DirectBufferProcessing</a></b>(const Buffer; Count: Integer): Boolean; virtual;</code></td>
</tr>
<tr class="list2">
<td class="visibility"><a  href="legend.html"><img  src="public.gif" alt="Public" title="Public"></a></td>
<td class="itemcode"><code>constructor <b><a  href="TelemetryNetIncomingStream.TIncomingStream.html#Create">Create</a></b>(aSocket: TCustomWinSocket = nil; aMaxSize: LongWord = <a  href="TelemetryNetIncomingStream.html#def_MaxSize">def_MaxSize</a>);</code></td>
</tr>
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="public.gif" alt="Public" title="Public"></a></td>
<td class="itemcode"><code>procedure <b><a  href="TelemetryNetIncomingStream.TIncomingStream.html#WriteIncomingBuffer">WriteIncomingBuffer</a></b>(const Buffer; Count: Integer); virtual;</code></td>
</tr>
<tr class="list2">
<td class="visibility"><a  href="legend.html"><img  src="public.gif" alt="Public" title="Public"></a></td>
<td class="itemcode"><code>procedure <b><a  href="TelemetryNetIncomingStream.TIncomingStream.html#GetPackets">GetPackets</a></b>; virtual;</code></td>
</tr>
</table>
<a name="PasDoc-Properties"></a><h3 class="summary">Properties</h3>
<table class="summary wide_list">
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="published.gif" alt="Published" title="Published"></a></td>
<td class="itemcode"><code>property <b><a  href="TelemetryNetIncomingStream.TIncomingStream.html#Socket">Socket</a></b>: TCustomWinsocket read <a  href="TelemetryNetIncomingStream.TIncomingStream.html#fSocket">fSocket</a>;</code></td>
</tr>
<tr class="list2">
<td class="visibility"><a  href="legend.html"><img  src="published.gif" alt="Published" title="Published"></a></td>
<td class="itemcode"><code>property <b><a  href="TelemetryNetIncomingStream.TIncomingStream.html#MaxSize">MaxSize</a></b>: LongWord read <a  href="TelemetryNetIncomingStream.TIncomingStream.html#fMaxSize">fMaxSize</a>;</code></td>
</tr>
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="published.gif" alt="Published" title="Published"></a></td>
<td class="itemcode"><code>property <b><a  href="TelemetryNetIncomingStream.TIncomingStream.html#OnOverflowClear">OnOverflowClear</a></b>: TSocketNotifyEvent read <a  href="TelemetryNetIncomingStream.TIncomingStream.html#fOnOverflowClear">fOnOverflowClear</a> write <a  href="TelemetryNetIncomingStream.TIncomingStream.html#fOnOverflowClear">fOnOverflowClear</a>;</code></td>
</tr>
<tr class="list2">
<td class="visibility"><a  href="legend.html"><img  src="published.gif" alt="Published" title="Published"></a></td>
<td class="itemcode"><code>property <b><a  href="TelemetryNetIncomingStream.TIncomingStream.html#OnPacket">OnPacket</a></b>: <a  href="TelemetryNetPackets.html#TPacketNotifyEvent">TPacketNotifyEvent</a> read <a  href="TelemetryNetIncomingStream.TIncomingStream.html#fOnPacket">fOnPacket</a> write <a  href="TelemetryNetIncomingStream.TIncomingStream.html#fOnPacket">fOnPacket</a>;</code></td>
</tr>
</table>
<h2 class="description">Description</h2>
<h3 class="detail">Fields</h3>
<table class="detail wide_list">
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="private.gif" alt="Private" title="Private"></a></td>
<td class="itemcode"><a name="fSocket"></a><code><b>fSocket</b>:          TCustomWinSocket;</code></td>
</tr>
<tr><td colspan="2">
<p>
See <a class="normal" href="TelemetryNetIncomingStream.TIncomingStream.html#Socket">Socket</a> property.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="private.gif" alt="Private" title="Private"></a></td>
<td class="itemcode"><a name="fMaxSize"></a><code><b>fMaxSize</b>:         LongWord;</code></td>
</tr>
<tr><td colspan="2">
<p>
See <a class="normal" href="TelemetryNetIncomingStream.TIncomingStream.html#MaxSize">MaxSize</a> property.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="private.gif" alt="Private" title="Private"></a></td>
<td class="itemcode"><a name="fOnOverflowClear"></a><code><b>fOnOverflowClear</b>: TSocketNotifyEvent;</code></td>
</tr>
<tr><td colspan="2">
<p>
Holds referece to <a class="normal" href="TelemetryNetIncomingStream.TIncomingStream.html#OnOverflowClear">OnOverflowClear</a> event handler.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="private.gif" alt="Private" title="Private"></a></td>
<td class="itemcode"><a name="fOnPacket"></a><code><b>fOnPacket</b>:        <a  href="TelemetryNetPackets.html#TPacketNotifyEvent">TPacketNotifyEvent</a>;</code></td>
</tr>
<tr><td colspan="2">
<p>
Holds reference to <a class="normal" href="TelemetryNetIncomingStream.TIncomingStream.html#OnPacket">OnPacket</a> event handler.</p>
</td></tr>
</table>
<h3 class="detail">Methods</h3>
<table class="detail wide_list">
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="protected.gif" alt="Protected" title="Protected"></a></td>
<td class="itemcode"><a name="DirectBufferProcessing"></a><code>Function <b>DirectBufferProcessing</b>(const Buffer; Count: Integer): Boolean; virtual;</code></td>
</tr>
<tr><td colspan="2">
<p>
When <a class="normal" href="TelemetryNetIncomingStream.TIncomingStream.html">TIncomingStream</a> receive any data, they are first send to this function. It will evaluate whether these data can be passed as one whole packet for further processing, without any store operation, and if yes, they are passed (an <a class="normal" href="TelemetryNetIncomingStream.TIncomingStream.html#OnPacket">OnPacket</a> event is called).<br> To directly pass the data, internal stream must be empty and the buffer must contain just one whole valid packet. If the data cannot be directly passed, they are stored (see <a class="normal" href="TelemetryNetIncomingStream.TIncomingStream.html#WriteIncomingBuffer">WriteIncomingBuffer</a> method for details).<br>

<p>

<p></p>
<h6 class="description_section">Parameters</h6>
<dl class="parameters">
<dt>Buffer</dt>
<dd>Incoming data that has to be processed.</dd>
</dl>
<h6 class="description_section">Returns</h6>
<p class="return"><code>True</code> when buffer was processed directly, <code>False</code> when it was stored.</p></td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="public.gif" alt="Public" title="Public"></a></td>
<td class="itemcode"><a name="Create"></a><code>constructor <b>Create</b>(aSocket: TCustomWinSocket = nil; aMaxSize: LongWord = <a  href="TelemetryNetIncomingStream.html#def_MaxSize">def_MaxSize</a>);</code></td>
</tr>
<tr><td colspan="2">
<p>
Object constructor.<br> If passed aMaxSize is smaller than <a class="normal" href="TelemetryNetIncomingStream.html#def_MaxSize">def_MaxSize</a> constant, then actual maximum size is set to <a class="normal" href="TelemetryNetIncomingStream.html#def_MaxSize">def_MaxSize</a>.

<p>

<p></p>
<h6 class="description_section">Parameters</h6>
<dl class="parameters">
<dt>aSocket</dt>
<dd><a class="normal" href="TelemetryNetIncomingStream.TIncomingStream.html#Socket">Socket</a> to which created instance will be bound. Can be <code>Nil</code>.</dd>
<dt>aMaxSize</dt>
<dd>Maximum size the stream can growth to (see <a class="normal" href="TelemetryNetIncomingStream.TIncomingStream.html#MaxSize">MaxSize</a> property).</dd>
</dl>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="public.gif" alt="Public" title="Public"></a></td>
<td class="itemcode"><a name="WriteIncomingBuffer"></a><code>procedure <b>WriteIncomingBuffer</b>(const Buffer; Count: Integer); virtual;</code></td>
</tr>
<tr><td colspan="2">
<p>
When connection receives data, they are passed to this method. If the data buffer cannot be directly processed, this function will store it in internal memory stream and calls <a class="normal" href="TelemetryNetIncomingStream.TIncomingStream.html#GetPackets">GetPackets</a> to check for packets in the whole stored stream. After that, size of the stream is evaluated and if it exceeds maximum allowed size, <a class="normal" href="TelemetryNetIncomingStream.TIncomingStream.html#OnOverflowClear">OnOverflowClear</a> event is called and the stream is cleared.

<p> </p>
<h6 class="description_section">Parameters</h6>
<dl class="parameters">
<dt>Buffer</dt>
<dd>Incoming data.</dd>
<dt>Count</dt>
<dd>Size of the buffer on bytes.</dd>
</dl>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="public.gif" alt="Public" title="Public"></a></td>
<td class="itemcode"><a name="GetPackets"></a><code>procedure <b>GetPackets</b>; virtual;</code></td>
</tr>
<tr><td colspan="2">
<p>
Searches the internal stream for any packet. If one is found, it is passed to <a class="normal" href="TelemetryNetIncomingStream.TIncomingStream.html#OnPacket">OnPacket</a> event. At the end of this method, all packets found in stream are deleted along with any data preceding them. Only data after the last packet are kept stored.</p>
</td></tr>
</table>
<h3 class="detail">Properties</h3>
<table class="detail wide_list">
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="published.gif" alt="Published" title="Published"></a></td>
<td class="itemcode"><a name="Socket"></a><code>property <b>Socket</b>: TCustomWinsocket read <a  href="TelemetryNetIncomingStream.TIncomingStream.html#fSocket">fSocket</a>;</code></td>
</tr>
<tr><td colspan="2">
<p>
Socket to which currend instance is bound.<br> This property is set during creation and thus is not initialized. Can be <code>Nil</code>.<br> This object is passed as &quot;Socket&quot; parameter in event calls.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="published.gif" alt="Published" title="Published"></a></td>
<td class="itemcode"><a name="MaxSize"></a><code>property <b>MaxSize</b>: LongWord read <a  href="TelemetryNetIncomingStream.TIncomingStream.html#fMaxSize">fMaxSize</a>;</code></td>
</tr>
<tr><td colspan="2">
<p>
Maximum size of the stream. If internal stream holding incoming data becames larger than this value, then <a class="normal" href="TelemetryNetIncomingStream.TIncomingStream.html#OnOverflowClear">OnOverflowClear</a> event is called and after that, the entire stream is cleared (deleted, not destroyed).<br> This mechanism is there to prevent uncontrolled stream growth when the connection produces large number of invalid data.<br> This value is set during creation and thus is not initialized.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="published.gif" alt="Published" title="Published"></a></td>
<td class="itemcode"><a name="OnOverflowClear"></a><code>property <b>OnOverflowClear</b>: TSocketNotifyEvent read <a  href="TelemetryNetIncomingStream.TIncomingStream.html#fOnOverflowClear">fOnOverflowClear</a> write <a  href="TelemetryNetIncomingStream.TIncomingStream.html#fOnOverflowClear">fOnOverflowClear</a>;</code></td>
</tr>
<tr><td colspan="2">
<p>
Called when the internal stream exceeds maximum allowed size, just before it is cleared. If you want to react before any data are deleted, this is the right place.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="visibility"><a  href="legend.html"><img  src="published.gif" alt="Published" title="Published"></a></td>
<td class="itemcode"><a name="OnPacket"></a><code>property <b>OnPacket</b>: <a  href="TelemetryNetPackets.html#TPacketNotifyEvent">TPacketNotifyEvent</a> read <a  href="TelemetryNetIncomingStream.TIncomingStream.html#fOnPacket">fOnPacket</a> write <a  href="TelemetryNetIncomingStream.TIncomingStream.html#fOnPacket">fOnPacket</a>;</code></td>
</tr>
<tr><td colspan="2">
<p>
Called whenever a valid packet is found in incoming data stream.<br> You must immediately process this packet, as it will be deleted right after the event handler returns.</p>
</td></tr>
</table>
<hr noshade size="1"><span class="appinfo"><em>Generated by <a  href="http://pasdoc.sourceforge.net/" target="_blank">PasDoc 0.13.0</a> on 2013-10-18 17:02:31</em>
</span>

</body>
</html>
